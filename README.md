[classifying-predicting-breast-cancer-tumors.ipynb](https://github.com/user-attachments/files/23692098/classifying-predicting-breast-cancer-tumors.ipynb)
{"cells":[{"metadata":{"_uuid":"490f4f04798bf8e91659ab9a9e1dd4d1fa139052","_cell_guid":"70776707-8fec-4f7b-aa73-fb1d96c98b54"},"cell_type":"markdown","source":"# Classifying/Predicting  Molecular Subtypes in Breast Cancer Tumors \n\nThis data set contains information on breast cancer patients with 4 major molecular subtypes of tumors: Luminal A, Luminal B, HER2 Enriched, and Basal(triple negative).  \n\n#### Methods used for classifying molecular subtypes are Ensemble-Boosting, Multinomial,K Nearest Neighbors,Support Vector Machine,  Naïve Bayes, eXtreme Gradient Boosting, and Neural Network \n\n## Table of Contents\n\n#### Part 1: Introduction\n#### Part 2: Information on Dataset\n#### Part 3: Loading Packages and Reading in datasets in Rstudio\n#### Part 4: Using Stringr to Manipulate Complete TCGA ID\n#### Part 5:  Using Only Variables/Predictors With At Least 99% Of The Data\n#### Part 6: Using Lasso For Variable/SubSet Selection.\n#### Part 7: Retrieving  Indexes of Relevant Variables From Lasso \n#### Part 8: Selecting Predictors By Column Number \n#### Part 9: Classifying Molecular Tumor Type Using Ensemble, Multinomial, K Nearest Neighbors, Support Vector Machine, and Other Machine Learning Methods\n#### Part 10 : Conclusions\n\n\n\n# Part 1: Introduction \n\nBreast Cancer is a multifactorial disease that forms in the cells of the breast. Breast cancer can occur in both men and women, but it's far more common in women. Breast cancer is the most common form of cancer in American women, the average risk of an American Women developing breast cancer in her life time is about 1 in 7 or about 12%. Of that 12 percent of women who do develop breast cancer, the cancer that a breast cancer patient will die from her disease is 2.7%.    \n\n**Density map of worldwide incidents of Breast Cancer**\n![breastcancerstatsworldwide](http://www.worldwidebreastcancer.com/wp-content/uploads/2011/08/breastcancerstatsworldwide.jpg)\n\nBreast cancer is often referred to as one disease, however there are many different types of breast cancers based on varying types of tumors. Tumors can vary in location, size, shape, and grade(severity). These characteristics, along with hormone receptor status and HER2 status affect prognosis. \n\n**Breast Cancer by the Numbers** \n![bythenumbers](http://www.julep.com/blog/wp-content/uploads/2014/10/FINAL-2014-Infographic-Julep_EdithSanford_5x5-1.jpg)\n\nThere are many factors that increase one’s chances in developing breast cancer, mutations in DNA are often the root causes of breast cancer. Other causes that may influence one’s susceptibility to developing breast cancer are mutations to genes that assist in cell differentiation (Proto-Oncogenes), and mutations to genes that modulate cell division, cellular repair, apoptosis (Tumor Suppressor Genes).  \n\nBreast cancer awareness and research funding has helped created advances in the diagnosis and treatment of breast cancer. Medical advances and innovation in treating breast cancer has increased survival rates, lower remission rates, and lower the number of deaths associated with the disease. More recently, the introduction of precision medicine and gene therapy has the potential to transform how physician treat breast cancer. Precision medicine refers to the tailoring of medical treatment based on the cellular profile of a disease and the patient’s genome. \n\nResearch has identified 4 major molecular subtypes within breast cancer tumors, these subtypes are based on the genes that cancer cell express: Luminal A, Luminal B, HER2 Enriched, and Basal (triple negative). Identifying and studying these subtypes has potential in planning more effective treatment and developing new therapies. Currently, Prognosis and treatment decisions are guided mainly by tumor stage, tumor grade, hormone receptor status and HER2 status. Molecular subtypes are mostly used in research settings; they are not part of a patients report and are not used to guide treatment. However, the use of molecular subtypes has greatly expanded, based on determining what genes are expressed in tumor samples, identifying subtypes of tumors can improve prognosis.\n\n# **The scope of this project is to correctly identify the molecular subtypes of tumors based on differences in gene expression. ** \n \n\n# Part 2: Information on Dataset\n\n\n1. 77_cancer_proteomes_CPTAC_itraq.csv\n\n\tIncludes protein expression values and metadata on 12553 genes from 80 breast cancer patients and 3 healthy individuals.\n\n\n2. clinical_data_breast_cancer.csv\n\n\tContains clinical data and  various breast cancer classifications from 105 breast cancer patients.\n    \n    Variables: **Complete TCGA ID',\n 'Gender',\n 'Age at Initial Pathologic Diagnosis',\n 'ER Status',\n 'PR Status',\n 'HER2 Final Status',\n 'Tumor',\n 'Tumor--T1 Coded',\n 'Node',\n 'Node-Coded',\n 'Metastasis',\n 'Metastasis-Coded',\n 'AJCC Stage',\n 'Converted Stage',\n 'Survival Data Form',\n 'Vital Status',\n 'Days to Date of Last Contact',\n 'Days to date of Death',\n 'OS event',\n 'OS Time',\n 'PAM50 mRNA',\n 'SigClust Unsupervised mRNA',\n 'SigClust Intrinsic mRNA',\n 'miRNA Clusters',\n 'methylation Clusters',\n 'RPPA Clusters',\n 'CN Clusters',\n 'Integrated Clusters (with PAM50)',\n 'Integrated Clusters (no exp)',\n 'Integrated Clusters (unsup exp)'**\n\n\n3. BCGENES.csv \n\n    This dataset was generated using subset reduction technique to trim down noisy gene variables and dylpr to inner_\\join variables from the 77_cancer_proteomes_CPTAC_itraq.csv and clinical_data_breast_cancer.csv\n    \n    Variables: **'PAM50 mRNA',\n 'myoferlin isoform a',\n 'heat shock protein HSP 90-beta isoform a',\n 'keratin, type II cytoskeletal 72 isoform 1',\n 'dedicator of cytokinesis protein 1',\n 'keratin, type I cytoskeletal 23',\n '1-phosphatidylinositol 4,5-bisphosphate phosphodiesterase beta-3 isoform 1',\n 'TBC1 domain family member 1 isoform 2',\n 'kinesin-like protein KIF21A isoform 1',\n 'ubiquitin carboxyl-terminal hydrolase 4 isoform a',\n 'PREDICTED: myomegalin-like',\n 'KN motif and ankyrin repeat domain-containing protein 1 isoform a',\n 'spermatogenesis-associated protein 5',\n 'TBC1 domain family member 9',\n 'receptor tyrosine-protein kinase erbB-2 isoform a precursor',\n 'epidermal growth factor receptor isoform a precursor',\n 'UPF0505 protein C16orf62',\n 'MICAL-like protein 1',\n 'UTP--glucose-1-phosphate uridylyltransferase isoform a',\n 'probable ATP-dependent RNA helicase DDX6',\n 'L-lactate dehydrogenase B chain',\n 'myelin expression factor 2',\n 'histone-lysine N-methyltransferase NSD3 isoform long',\n 'histone-lysine N-methyltransferase NSD3 isoform short',\n 'signal transducer and activator of transcription 6 isoform 1',\n 'WD repeat-containing protein 91',\n 'UPF0553 protein C9orf64',\n 'ran-binding protein 9',\n 'arfaptin-1 isoform 2',\n 'tonsoku-like protein',\n 'protein LSM14 homolog B',\n 'oxysterol-binding protein-related protein 2 isoform 2',\n 'PDZ domain-containing protein GIPC2',\n 'calpain small subunit 2',\n 'condensin-2 complex subunit G2',\n 'telomere length regulation protein TEL2 homolog',\n 'guanine nucleotide-binding protein G(olf) subunit alpha isoform 1',\n 'squalene synthase',\n 'cathepsin B preproprotein',\n \"5'-nucleotidase domain-containing protein 2 isoform 1\",\n 'COBW domain-containing protein 1 isoform 2',\n 'transcription elongation factor A protein-like 5',\n 'DNA repair protein XRCC4 isoform 1',\n 'transmembrane protein 132A isoform a precursor',\n 'alpha-methylacyl-CoA racemase isoform 3',\n 'trans-acting T-cell-specific transcription factor GATA-3 isoform 1',\n 'uncharacterized protein C7orf43',\n 'molybdopterin synthase catalytic subunit large subunit MOCS2B',\n 'Golli-MBP isoform 1',\n 'hepatocyte nuclear factor 3-gamma',\n '39S ribosomal protein L40, mitochondrial',\n 'migration and invasion enhancer 1',\n 'ubiquitin-conjugating enzyme E2 E3',\n 'protein S100-A13',\n 'transcription initiation factor TFIID subunit 8',\n 'phosphoribosyltransferase domain-containing protein 1',\n 'polyadenylate-binding protein-interacting protein 2'].**\n\n### Manipulation of Breast Cancer Proteomes and Clinical Data Breast Cancer datasets in Rstudio\n\nThe data used in this portion of the project was gathered from kaggle. The original dataset includes 12553 unique genes from a total of 80 breast cancer patients and 3 healthy individuals. Further examination has identified the variable ‘Complete TCGA ID’ to be in both the 77_cancer_proteomes_CPTAC_itraq.csv dataset and the clinical_data_breast_cancer.csv dataset. The Complete TCGA ID refers to a breast cancer patient, some patients can be found in both datasets. This is vital to our classification problem, since there are clinical records and proteome data for each patient. \n\nThere are two substantial issues with the Complete TCGA ID variable. The first issue being the Complete TCGA ID does not entirely match up in the datasets(AO-A12D.01TCGA\n = TCGA-AO-A12D); The second issue is the Complete TCGA ID in 77_cancer_proteomes_CPTAC_itraq.csv is treated as variables (recorded as columns) whereas the clinical_data_breast_cancer.csv treats each ID as a record (recorded as a row). To solve the first problem, we use the package stringr to manipulate the Complete TCGA ID so that they follow a similar syntax in both datasets. To solve the second problem, we can transpose the dataset in excel, reassigning Complete TCGA ID as a row and gene expressions as columns. These transformations need to occur before we can combine datasets. \n\nThe only variable needed from clinical_data_breast_cancer.csv is 'PAM50 mRNA', which is the recorded molecular subtype. Using the package dpylr, we can select the variables: 'PAM50 mRNA' and ‘Complete TCGA ID’ from clinical_data_breast_cancer.csv and inner join both datasets by a unique Complete TCGA ID. The result of the dataset manipulation is that we now have a single data set that encompasses 12553 unique genes and the molecular tumor type from 80 patients. \n\n** Since we transpose the 77_cancer_proteomes_CPTAC_itraq.csv, we cannot use the original dataset, or else inner joining the two datasets will fail. I have uploaded transposed version of the 77_cancer_proteomes_CPTAC_itraq.csv dataset which will be used.**\n\n### Variable Reduction of the 77_cancer_proteomes_CPTAC_itraq.csv dataset using Lasso \nFor classification purposes, it is not ideal to include all 12553 unique genes in a classification model, as overfitting can yield misleading results.   \n\nIt is common that genetic datasets exhibit cases where n, the number of observations is larger than the p, the number or predictors. When p >n, there is no longer a unique least squares coefficient estimate. Often when p>n, high\nvariance and overfitting are a major concern in this setting. Thus,\nsimple, highly regularized approaches often become the methods of choice. To address this issue, there are many techniques (Subset selection), (Lasso and Ridge) and (Dimension reduction) to exclude irrelevant variables from a regression or a dataset. \n\nUsing a Shrinkage Method known as Lasso in Rstudio, we fit a model containing all 12553 predictors\nthat constrains or regularizes the coefficient estimates, or equivalently, that\nshrinks the coefficient estimates towards zero. Variables with a coefficient estimate of zero are left out of the final model. **The results of the lasso method on the 77_cancer_proteomes_CPTAC_itraq.csv indicates 56 relevant variables that will be used in predicting tumor type and for data visualization.**\n\nThe significant 56 genes from a sample of breast cancer patients along with the associated tumor types are then queried out in RStudio into dataset BCGENES.csv. **BCGENES.csv is the main dataset which will be used for classification .** A variable importance plot from Rstudio of the cancer data indicates the top 5 most influential genes we will use for data visualization purposes.\n"},{"metadata":{"_uuid":"a57c922da3475f028e8e80498f9aaa6a9e803d14","_cell_guid":"4646a8b4-1b5d-4c12-bbae-203b6a9134b1"},"cell_type":"markdown","source":"# Part 3: Loading Packages and Reading in datasets in Rstudio"},{"metadata":{"_kg_hide-output":true,"_uuid":"b60276a0916a107c62defa73f6008dc18e05971e","trusted":false,"_cell_guid":"17f16040-3ce2-4511-9074-957b99d67e09"},"cell_type":"code","source":"library(stringr) #assist with text manipulation\nlibrary(dplyr) # data manipulation\nlibrary(readr) # data input\nlibrary(caret) #select tuning parameters\nlibrary(MASS) # contains the data\nlibrary(nnet) # used for Multinomial Classification \nlibrary(readr) #assist with text manipulation\nlibrary(kernlab) #assist with SVM feature selection\nlibrary(class) # used for an object-oriented style of programmin\nlibrary(KernelKnn) # used for K- Nearest-Neighbors method\nlibrary(nnet) # Used for Neural Net\nlibrary(e1071) \nlibrary(gbm)\nlibrary(xgboost) # Used for xgbTree","execution_count":null,"outputs":[]},{"metadata":{"_kg_hide-output":true,"_uuid":"26244077bfb71f88ec4e439881d33f748e3406c9","trusted":false,"_cell_guid":"ec45a985-a7c3-451b-9b92-acfa0f36cec6"},"cell_type":"code","source":"SSC <-read_csv(\"../input/transposed/77_cancer_proteomes_CPTAC_itraq.csv\")\ndim(SSC) #86 records, 12553 predictors\nclin <-read_csv(\"../input/editpam50/clinical_data_breast_cancer.csv\")\ndim(clin) #105 Records, 30 clinical predictors/measurements","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"257d5feb580e5239184494da046e7faeab09c482","_cell_guid":"417d4c14-1356-40b4-84d1-c011a06f157e"},"cell_type":"markdown","source":"# Part 4: Using Stringr to Manipulate Complete TCGA ID\n\n We can combine datasets if the rows share a unique id/reference number; both datasets share a unique id value (Complete TCGA ID). We will use the Complete TCGA ID variable to combine these datasets together. However, the Complete TCGA ID does not entirely match up in the datasets, where AO-A12D.01TCGA\n = TCGA-AO-A12D.  To combine the clinical and proteomes datasets we use the package stringr to manipulate the Complete TCGA ID so that they follow a similar syntax in both datasets. \n \n The code below manipulates the Complete TCGA ID number in the Proteomes dataset, queries the Complete TCGA ID number and Molecular tumor type from the Clinical dataset and combines the Proteomes and Clinical dataset as **MASTER**."},{"metadata":{"_uuid":"013dcd9d7da978557e28a60c0c6c8f096e045890","trusted":false,"_cell_guid":"ab1b56a3-6983-40a2-8dcc-b81f01191ec7"},"cell_type":"code","source":"p1<-str_replace(SSC$`Complete TCGA ID`,\"TCGA\",\"\")\np2<-str_replace(p1,\".\\\\d+$\",\"\")\np3<-str_replace(p2,\"^\",\"TCGA-\")\n\nfor (i in seq(1:83)){\n  SSC$`Complete TCGA ID`[i]<-p3[i]\n}\n\ncolnames(clin)\nclinp<-clin[,c(1,21)]\n\nMASTER<- inner_join(SSC,clinp)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"615fa9d9ad573178a1648665b70aeda0f147c8e5","_cell_guid":"a8939ae8-0ddc-484f-be6d-04a3fa067791"},"cell_type":"markdown","source":"# Part 5: Using Only Variables/Predictors With At Least 99% Of The Data\n\nThe data frame **MASTER** contains all variables needed for tumor classification. There is an issue of some gene expressions having missing data. To account for missing data, we identify  gene expressions with at least 99% of data and store them in the **CDF** data frame. Any gene expressions with less than 99% of the data does not meet our criteria and is excluded from the **CDF** data frame. "},{"metadata":{"_uuid":"ebfb68b349c34fba00a273f7d4c343c20d025df6","trusted":false,"_cell_guid":"80a4d82b-9b21-46b4-b097-ee60c420514b"},"cell_type":"code","source":"#use only variables with 99% of the data\npcent<-sapply(MASTER, function(x) sum(!is.na(x))/length(x))\n              \nclean <- MASTER[1]\nfor (i in seq(2, 12554))\n{\n  if(pcent[i]>0.99){\n    clean<-cbind(clean,MASTER[i])\n  }\n}\n\n# Remove any NA's in the data frame,change to 0\nclean[is.na(clean)] <- 0\nCDF<-clean\n\n#Remove the Complete TCGA ID from the CDF data frame.\n# No longer needer for molecular classification\nCDF<-CDF[-1]\nattach(CDF)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"776c9519eaa799bde5fb7c7c457c78f30c6f4142","_cell_guid":"adc1b509-0505-4ada-9517-2e775bf42042"},"cell_type":"markdown","source":"# Part 6: Using Lasso For Variable/SubSet Selection.\n\nIt is common that genetic datasets exhibit cases where n, the number of observations is larger than the p, the number or predictors. When p >n, there is no longer a unique least squares coefficient estimate. Often when p>n, high variance and overfitting are a major concern in this setting. Thus, simple, highly regularized approaches often become the methods of choice. To address this issue, there are many techniques (Subset selection), (Lasso and Ridge) and (Dimension reduction) to exclude irrelevant variables from a regression or a dataset.\n\nUsing a Shrinkage Method known as Lasso in Rstudio, we fit a model containing all 12553 predictors that constrains or regularizes the coefficient estimates, or equivalently, that **shrinks the coefficient estimates towards zero. Variables with a coefficient estimate of zero are left out of the final model.** \n\nThe results of the Lasso data reduction technique are too large to be view in the Rstudio console. Therefore the results exported into a txt file on your local machine. "},{"metadata":{"_kg_hide-output":true,"_uuid":"6730c7a9b205825b96e92d488ef72583ef81e830","trusted":false,"_cell_guid":"4c42f220-8e7c-4f16-89eb-5c8aaafb3d0c"},"cell_type":"code","source":"## Randomly dividing our dataset, which encompasses 4 major molecular tumor types, into datasets for testing and training out model. \nlibrary(glmnet)\nCDF$`PAM50 mRNA`<- as.factor(CDF$`PAM50 mRNA`)\nx<-model.matrix(CDF$`PAM50 mRNA`~., CDF)\ntrain<-sample(1:nrow(x), nrow(x)/2)\ntest<-(-train)\ny<-CDF$`PAM50 mRNA`\ny.test<-y[test]\nset.seed(1) \n\n\n#Setting up parameters \ngrid <- 10^seq(10,-2, length =100)\nCDF$`PAM50 mRNA`<- as.factor(CDF$`PAM50 mRNA`)\nset.seed (1)\ncv.out<-cv.glmnet(x[train,],y[train],alpha=1,lambda =grid,family=\"multinomial\",type.multinomial=\"grouped\")\nplot(cv.out)\nbestlam<-cv.out$lambda.min\n\n#  The results of the Lasso data reduction technique are exported onto your local machine for optimal viewing.\nout<-glmnet(x,y,alpha =1, lambda=grid,family=\"multinomial\",type.multinomial=\"grouped\")\nlasso.coef<-predict(out,type =\"coefficients\",s=bestlam,family=\"multinomial\",type.multinomial=\"grouped\")\nsink(file=\"lasso.txt\")\noptions(\"max.print\"=8020)\nlasso.coef\nsink(NULL)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"41dbf37ec022c37b96ad4600f8ba303c00950022","_cell_guid":"622cd9d1-58dd-4c7d-899f-8b678b0a7626"},"cell_type":"markdown","source":"# Part 7: Retrieving  Indexes of Relevant Variables From Lasso \nUpon reviewing the lasso.txt file, there are 58 genetic predictors with non-zero coefficients. These are the predictors that are used to classify molecular tumor type, the following code identity’s the location of each predictor within the dataset and retrieves its column number. \n\nThe column number allows one to directly select a predictor by its column number rather than having to select by name.  **Inputting 1017 is simpler and cleaner than typing out `1-phosphatidylinositol 4,5-bisphosphate phosphodiesterase beta-3 isoform 1`.** "},{"metadata":{"_uuid":"e0a42a8a4cb7a5a37a7f889a37e85dbd1226b89c","_cell_guid":"873238e8-e87a-4bbd-a243-803f4975b022"},"cell_type":"markdown","source":"#Reading in and printing the column numbers of all genes for final dataset indexing\nsink(file=\"colindex.txt\")\noptions(\"max.print\"=8100)\ncolnames(CDF)\nsink(NULL)\n\n# List of the 56 genetic predictors and the assoicated column number\n\n`myoferlin isoform a` 142\n`heat shock protein HSP 90-beta isoform a` 258\n`keratin, type II cytoskeletal 72 isoform 1` 283\n`cingulin` 342\n`dedicator of cytokinesis protein 1` 537\n`keratin, type I cytoskeletal 23`774\n`1-phosphatidylinositol 4,5-bisphosphate phosphodiesterase beta-3 isoform 1` 1017\n`TBC1 domain family member 1 isoform 2` 1069\n`kinesin-like protein KIF21A isoform 1` 1107\n`ubiquitin carboxyl-terminal hydrolase 4 isoform a` 1125\n`PREDICTED: myomegalin-like` 1164\n`KN motif and ankyrin repeat domain-containing protein 1 isoform a` 1280\n`spermatogenesis-associated protein 5` 1281\n`TBC1 domain family member 9` 1352\n`receptor tyrosine-protein kinase erbB-2 isoform a precursor` 1376\n`epidermal growth factor receptor isoform a precursor` 1377\n`UPF0505 protein C16orf62` 1572\n`MICAL-like protein 1` 1643\n`UTP--glucose-1-phosphate uridylyltransferase isoform a` 1717\n`probable ATP-dependent RNA helicase DDX6` 1848\n`L-lactate dehydrogenase B chain` 1916\n`myelin expression factor 2` 2037\n`histone-lysine N-methyltransferase NSD3 isoform long` 2065\n`histone-lysine N-methyltransferase NSD3 isoform short` 2067\n`signal transducer and activator of transcription 6 isoform 1` 2540\n`WD repeat-containing protein 91` 2726\n`UPF0553 protein C9orf64` 3201\n`ran-binding protein 9` 3226\n`arfaptin-1 isoform 2` 3438\n`tonsoku-like protein` 3567\n`protein LSM14 homolog B` 3606\n`oxysterol-binding protein-related protein 2 isoform 2` 3629\n`PDZ domain-containing protein GIPC2` 3807\n`calpain small subunit 2` 4075\n`condensin-2 complex subunit G2` 4083\n`telomere length regulation protein TEL2 homolog` 4088\n`guanine nucleotide-binding protein G(olf) subunit alpha isoform 1` 4116\n`squalene synthase` 4613\n`cathepsin B preproprotein` 4816\n`5'-nucleotidase domain-containing protein 2 isoform 1` 4894\n`COBW domain-containing protein 1 isoform 2` 4914\n`transcription elongation factor A protein-like 5`5218\n`DNA repair protein XRCC4 isoform 1` 5542\n`transmembrane protein 132A isoform a precursor` 5574\n`transcription factor AP-2-beta` 5628\n`alpha-methylacyl-CoA racemase isoform 3` 5693\n`trans-acting T-cell-specific transcription factor GATA-3 isoform 1` 6111\n`uncharacterized protein C7orf43` 6179\n`molybdopterin synthase catalytic subunit large subunit MOCS2B` 6533\n`Golli-MBP isoform 1` 6581\n`hepatocyte nuclear factor 3-gamma` 6769\n`39S ribosomal protein L40, mitochondrial`7015\n`migration and invasion enhancer 1`7319\n`ubiquitin-conjugating enzyme E2 E3` 7331\n`protein S100-A13`7357\n`transcription initiation factor TFIID subunit 8`7425\n`phosphoribosyltransferase domain-containing protein 1`7512\n`polyadenylate-binding protein-interacting protein 2`7923"},{"metadata":{"_uuid":"756efd6c71b9bee730d3d6fabc20c04a69192fd2","_cell_guid":"a37e7060-e36d-49ff-8314-5c7dcc6352dc"},"cell_type":"markdown","source":"# Part 8: Selecting Predictors By Column Number \n\nReferring to **Part 5**, we identified gene expressions with at least 99% of data and stored them in the **CDF** data frame. Therefore, the code below selects the predictors that have non-zero coefficients, which were  identified in **part 6**,from the **CDF** data frame and stores these predictors along with the variable for molecular tumor type (`PAM50 mRNA`) into a new data frame **testdf**. "},{"metadata":{"_uuid":"e173290316f3898a34c468f07b3744fee95d3663","trusted":false,"_cell_guid":"24c56c91-dc74-4496-b301-70e48761eaa0"},"cell_type":"code","source":"testdf<-CDF[,c(8018,142,258,283,537,774,1017,1069,1107,1125,1164,1280,1281,1352,\n               1376,1377,1572,1643,1717,1848,1916,2037,2065,2067,2540,2726,3201,\n               3226,3438,3567,3606,3629,3807,4075,4083,4088,4116,4613,4816,4894,\n               4914,5218,5542,5574,5693,6111,6179,6533,6581,6769,7015,7319,\n               7331,7357,7425,7512,7923)]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"61078e2fdefe4416a84a01153c3c0f350fb18f04","_cell_guid":"59597a3f-4371-497b-ad9c-fc06881a43af"},"cell_type":"markdown","source":"# Part 9: Classifying Molecular Tumor Type Using Ensemble, Multinomial, K Nearest Neighbors, Support Vector Machine, and Other Machine Learning Methods "},{"metadata":{"_uuid":"4c4e2dddb55c8f07a0a43dddf077c11ffc9bbdbe","_cell_guid":"78925bd0-9dac-42d7-bb5c-6b0fafd301ea"},"cell_type":"markdown","source":"## Molecular Tumor Type Using Ensemble-Boosting Regression Tree \n\nGradient boosting is a machine learning technique for regression and classification problems, the basis involves 3 broad elements. \n\n1. A loss function to be optimized.\n2. A weak learner to make predictions.\n3. An additive model to add weak learners to minimize the loss function.\n\nGradient boosting produces a prediction model in the form of an ensemble of weak prediction models. \n\nThe code below uses the package **gbm**.  The **first figure** shows the relative information value of all variables in numeric form. Indicating that `hepatocyte nuclear factor 3-gamma` and `signal transducer and activator of transcription 6 isoform 1` are heavily influential in determining molecular tumor type. The **second figure** shows the relative information value on a horizontal bar plot. The **third figure** shows the lowest number of iterations with the lowest multinomial Deviance. Essentially is quantifies the accuracy of a classifier by penalizing false classifications, the goal is to minimize the multinomial deviance and increase accuracy.   \n\nThe second block of code is where the  Ensemble-Boosting method is applied to our data. We run the model 20 times and compute the average the accuracy, this is the best estimate since the range is extensive. "},{"metadata":{"_uuid":"abc279f7c853aa5bc099f545a2a5febbb637d99d","trusted":false,"_cell_guid":"5936d0f9-ae84-495c-9d32-a0f7e2b0215f"},"cell_type":"code","source":"testdf$`PAM50 mRNA`<- as.factor(testdf$`PAM50 mRNA`)\n\ngbm.model<-gbm(`PAM50 mRNA`~., data=testdf, shrinkage=0.01, distribution = 'multinomial',\n               cv.folds=5, n.trees=5000, verbose=F)\nsummary(gbm.model)\nbest.iter<-gbm.perf(gbm.model, method=\"cv\")","execution_count":null,"outputs":[]},{"metadata":{"_kg_hide-output":true,"_uuid":"64c78e89ef8716bd1e8424c8ac2f7d539762d3e0","trusted":false,"_cell_guid":"08f582fb-c6c1-41ae-8d16-534ab254137b"},"cell_type":"code","source":"fitControl <- trainControl(method=\"cv\", number=10, returnResamp = \"all\",classProbs = TRUE, summaryFunction = multiClassSummary)\nAccuraciesGLM<- c(0,0,0)\nfor(i in seq(20)){\n  train<- createDataPartition(testdf$`PAM50 mRNA`, p = .70, list = FALSE)\n  trainDF<-testdf[train,]\n  testDF<-testdf[-train,]\n  trainDF$`PAM50 mRNA`<-as.factor(trainDF$`PAM50 mRNA`)\n  testDF$`PAM50 mRNA`<-as.factor(testDF$`PAM50 mRNA`)\n  gbm.model<-gbm(`PAM50 mRNA`~., data=testdf, shrinkage=0.01, distribution = 'multinomial',\n                 cv.folds=5, n.trees=5000, verbose=F)\n  best.iter<-gbm.perf(gbm.model, method=\"cv\")\n  \n  obj<-train(`PAM50 mRNA`~., data=trainDF, method=\"gbm\",distribution=\"multinomial\",\n             trControl=fitControl, verbose=F,metric = \"ROC\",\n             tuneGrid=data.frame(.n.trees=best.iter, .shrinkage=0.01, .interaction.depth=4, .n.minobsinnode=1))\n  \n  AccuraciesGLM[i] <- confusionMatrix(predict(obj,newdata=testDF[-1]),testDF$`PAM50 mRNA`)$overall[\"Accuracy\"]\n}","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"2513589dcb6021fba07e8a1efa8ed369dd628146","trusted":false,"_cell_guid":"bd544590-2609-44fc-bd9b-fcde38c4b6bd"},"cell_type":"code","source":"plot(density(AccuraciesGLM))\nsummary(AccuraciesGLM)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"24a8b9de57bb81d892bd5e8a45dbd36ef8265123","_cell_guid":"36dd235f-b726-4057-b20e-f6c1bcf640b8"},"cell_type":"markdown","source":"## Molecular Tumor Type Using K- Nearest-Neighbors \n\nK- Nearest-Neighbors is a non-parametric used for classification/pattern recognition. Before using KNN, all variables are to be normalized and scaled appropriately. To use KNN; one must select the number cluster neighbors (k), the algorithm than uses a weighted average of k nearest neighbors and computes an Euclidean distance. Values near to one another contribute more to the average than distant values. KNN classifies based on how similar our testing data is to the training set. One of the disadvantages of KNN is that it is relies heavily on human input, we must choose the number on neighbors for classification purposes. Since KNN is a non-parametric method, group distance is unimportant since we are not concerned about the distribution of the data, also we can used mixed data, however KNN does not provide a model. \n"},{"metadata":{"_kg_hide-output":true,"_uuid":"b113d08fa6d2dd1d2d1d53238cf9c72a471b25a6","trusted":false,"_cell_guid":"1e5eb211-e558-4a98-b3bc-fa1c49b998be"},"cell_type":"code","source":"library(class)\nlibrary(KernelKnn)\nAccuraciesKNN<-c(0,0,0)\n#choose which measurements to use in classification\ntf<-testdf\nx<-tf[2:57]\n#choose which group labels to use in classification\ny<-factor(testdf$`PAM50 mRNA`)\n\nfor (i in seq(300)){\n  kcres3 <-knn.cv(x, y, k = 3, prob= TRUE)\n  AccuraciesKNN[i] <-confusionMatrix(kcres3,testdf$`PAM50 mRNA`)$overall[\"Accuracy\"]\n}","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5fcb8161015c3491fffa41f579d6b0fc6c2d009f","trusted":false,"_cell_guid":"d1df57a8-c5c3-4f39-89fe-c23f9417cceb"},"cell_type":"code","source":"summary(AccuraciesKNN)\nplot(density(AccuraciesKNN))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"ae4177407b90788fdb586b6f8df5e156af44b7c2","_cell_guid":"7ef981ec-a9fa-4ad3-ac85-e6460eefd639"},"cell_type":"markdown","source":"## Molecular Tumor Type Using Support Vector Machines\n\nSupport Vector Machines are generalized extension of a maximal margin classifier, SVM are intended for the binary classification setting when there are two classes. However, this designed intention does not disqualify from using the SVM method with cases of more than two classes. SVM determines the best line separator by identifying closest points in Convex hull, a hyperplane bisects the closest point to the convex hull. The support vector classifies a test observation depending on which side of a plane it lies; this is based on boundaries-support vectors. SVM method allows some observations to be on the incorrect side of the margin and in some cases the incorrect side of the hyperplane in the interest of performing better in classifying the remaining observations further away from the hydroplane. This is known as a soft margin classifier; training observations can violate this area. Advantages of using a SVM  model are; can be adapted to work well with nonlinear boundaries, uses kernels, less overfitting of data, performs well with clear margin of separation among data."},{"metadata":{"_kg_hide-output":true,"_uuid":"f13bc6ebfe233ab7a5f58fcffd17c851b373266d","trusted":false,"_cell_guid":"9969a0b6-2297-47ff-8ea3-d2e9b0d5249e"},"cell_type":"code","source":"library(kernlab)\nAccuraciesSVM <- c(0,0,0)\nfor(i in seq(1000)){\n  \n  train<- createDataPartition(testdf$`PAM50 mRNA`, p = .70, list = FALSE)\n  trainDF<-testdf[train,]\n  testDF<-testdf[-train,]\n  \n  train.ksvm<-ksvm(`PAM50 mRNA` ~.,\n                   scale = TRUE,\n                   data=trainDF,\n                   kernel=\"rbfdot\",\n                   prob.model=TRUE)\n  \n  AccuraciesSVM[i] <- confusionMatrix(testDF$`PAM50 mRNA`, predict(train.ksvm, testDF))$overall[\"Accuracy\"]\n}","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"38c14a3ade1bceda65739336195e256728501ed7","trusted":false,"_cell_guid":"d148f7d5-90a0-4426-9237-a5777b34fd4d"},"cell_type":"code","source":"summary(AccuraciesSVM)\nplot(density(AccuraciesSVM))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"7e0a21f0da6961735136cc7152ff6a64fe0526fc","_cell_guid":"4cecc080-6df8-4420-9ed0-78a4c74e3893"},"cell_type":"markdown","source":"## Molecular Tumor Type Using Naïve Bayes Methods\n\nThe Naïve Bayes Algorithm is a classifier based on applying Bayes theorem with independent assumptions between features. Meaning that all features in the data set are equally important and independent of one another. Bayesian probability Is rooted in the theory that the likelihood of an event should be based on the evidence across multiple trials. Naïve Bayes uses probabilities to classify groups based on prior probability. One advantage is that Naïve Bayes works with mixed data: nominal, continuous and ordinal variables. Naïve Bayes is fast and effective, handles missing and noisy data well, and requires few records for training and can also work well with large records.  Disadvantages of Naïve Bayes is that it assumes that all the data predictors are independent when in data is far from this faulty assumption. Also, estimated probabilities are less reliable than predicted classes. "},{"metadata":{"scrolled":true,"_kg_hide-output":true,"_uuid":"310acf23da1a52f9542b49c142e9d8a46dd26520","trusted":false,"_cell_guid":"150df1e0-3a95-418a-9720-a3d828d040c8"},"cell_type":"code","source":"AccuraciesNaive <- c(0.00)\nfor (i in seq(100)) \n{\n \n  train<- createDataPartition(testdf$`PAM50 mRNA`, p = .70, list = FALSE)\n  trainDF<-testdf[train,]\n  testDF<-testdf[-train,]\n  nb1 <- train(`PAM50 mRNA`~., data = trainDF, method = \"nb\",\n               trControl = trainControl(method = \"cv\"),\n               tuneGrid = data.frame(usekernel = TRUE, fL = 0.5, adjust = 5))\n  bps <- predict(nb1, newdata=testDF)\n  AccuraciesNaive[i] <- confusionMatrix(testDF$`PAM50 mRNA`,bps)$overall[\"Accuracy\"]\n}","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"b75733d72e91061e21e92936324744406b7d0680","trusted":false,"_cell_guid":"a566d07e-790c-4024-89b3-b4ef52cacadc"},"cell_type":"code","source":"plot(density(AccuraciesNaive))\nsummary(AccuraciesNaive)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"bc6591aa64e009a07f102fb09db16da89e782904","_cell_guid":"7fa8c0d2-9470-4e71-b36e-103d34ac906e"},"cell_type":"markdown","source":"## Molecular Tumor Type Using Multinomial Method\n\nThe Multinomial method is a classifier that is used to predict the probabilities of the different possible outcomes of a categorically dependent variable. One assumption is that collinearity among independent variables are relatively low."},{"metadata":{"_uuid":"717fa9b9dc09c2b343b9db94eab90a6c77050a33","trusted":false,"_cell_guid":"18e3142d-345b-4dc8-bf69-6726f3d9ca7a"},"cell_type":"code","source":"AccuraciesMultinomial<- c(0,0,0)\nfor(i in seq(1000)){\n  train<- createDataPartition(testdf$`PAM50 mRNA`, p = .70, list = FALSE)\n  trainDF<-testdf[train,]\n  testDF<-testdf[-train,]\n  \n  net<-multinom(`PAM50 mRNA`~.,\n                data=trainDF,trace=FALSE)\n  AccuraciesMultinomial[i] <- confusionMatrix(predict(net, newdata=testDF, \"class\"),testDF$`PAM50 mRNA`)$overall[\"Accuracy\"]\n}","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1e8bcf837b555342af217b97d0afaca6b143132d","trusted":false,"_cell_guid":"ad39f2ff-bba9-4d02-92ad-46922428225b"},"cell_type":"code","source":"plot(density(AccuraciesMultinomial))\nsummary(AccuraciesMultinomial)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"22bab31ccaeb76c7d7354be7f69603ff7d5d0551","_cell_guid":"d322d3a2-6de5-41e3-b895-4d8190f9fba3"},"cell_type":"markdown","source":"## Molecular Tumor Type Using eXtreme Gradient Boosting\n\nXGBoost (eXtreme Gradient Boosting) is a machine learning classifier/predictor, which produces a model in a form of an esemble of weak prediction models. XGBoost helps to reduce overfitting. "},{"metadata":{"scrolled":true,"_uuid":"1abeaf467bb7bcd11f7221de9834ea002539ec9b","trusted":false,"_cell_guid":"ef376a20-f2b3-47c2-99a2-28badcfecfda"},"cell_type":"code","source":"xgbGrid <- expand.grid(nrounds = c(1, 10),\n                       max_depth = c(1, 4),\n                       eta = c(.1, .4),\n                       gamma = 0,\n                       colsample_bytree = .7,\n                       min_child_weight = 1,\n                       subsample = c(.8, 1))\n\ncctrl1 <- trainControl(method = \"cv\", number = 3, returnResamp = \"all\",\n                       classProbs = TRUE)\n\nAccuraciesXGBTREE <- c(0.00)\nfor (i in seq(100)) \n{\n  \n  train<- createDataPartition(testdf$`PAM50 mRNA`, p = .70, list = FALSE)\n  trainDF<-testdf[train,]\n  testDF<-testdf[-train,]\n  trainDF$`PAM50 mRNA`<- as.factor(trainDF$`PAM50 mRNA`)\n  \n  xgb <- train(`PAM50 mRNA` ~., data=trainDF, \n                               method = \"xgbTree\", \n                               trControl = cctrl1,\n                               preProc = c(\"center\", \"scale\"),\n                               tuneGrid = xgbGrid)\n  \n  bpred <- predict(xgb, newdata=testDF)\n  AccuraciesXGBTREE[i] <- confusionMatrix(testDF$`PAM50 mRNA`,bpred)$overall[\"Accuracy\"]\n}\n\nplot(density(AccuraciesXGBTREE))\nsummary(AccuraciesXGBTREE)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"f9f7bcd0c2a2ea888d7700baea62c8752a98d2b4","_cell_guid":"14777bf1-4fd7-4072-84cd-407c02664f87"},"cell_type":"markdown","source":"## Molecular Tumor Type Using Neural Network\n\nInspired by biological neural networks, the Neural Network method is a supervised machine learning algorithm which consists of units arranged in layers which coverts an input vector (independent variable) into a prediction/classification.  \"The algorithm learns a function by training on a dataset without prior knowledge about the dataset.\" "},{"metadata":{"_uuid":"58f5749125991ab5f096db0b894fa87cc739ec0b","trusted":false,"_cell_guid":"1938be87-65f2-4572-aaaa-2b3e72eb0ab8"},"cell_type":"code","source":"cctrlR <- trainControl(method = \"cv\", number = 3, returnResamp = \"all\", search = \"random\")\n\nAccuraciesNNET <- c(0.00)\nfor (i in seq(100)) \n{\n  \n  train<- createDataPartition(testdf$`PAM50 mRNA`, p = .70, list = FALSE)\n  trainDF<-testdf[train,]\n  testDF<-testdf[-train,]\n  trainDF$`PAM50 mRNA`<- as.factor(trainDF$`PAM50 mRNA`)\n  \n  nn <- train(`PAM50 mRNA` ~., data=trainDF, \n               method = \"nnet\", \n               trControl = cctrl1,\n               preProc = c(\"center\", \"scale\"),\n               trace = FALSE)\n  \n  nnpred <- predict(nn, newdata=testDF)\n  AccuraciesNNET[i] <- confusionMatrix(testDF$`PAM50 mRNA`,nnpred)$overall[\"Accuracy\"]\n}\n\nplot(density(AccuraciesNNET))\nsummary(AccuraciesNNET)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"a8050f82df10cf57a8ededa40b4e729ce5096097","_cell_guid":"ffb0cbff-dd31-47fd-bddc-18af14d40c97"},"cell_type":"markdown","source":"## Molecular Tumor Type Using eXtreme Gradient Boosting With Random Variables\n\nOne way to test and visualize how accurately the models perform is to generate a separate model in which the independent variables are randomly selected. Previously, independent variables with a coefficient estimate greater than zero were selected using the LASSO method- this method performs variable selection to increase accuracy of a prediction. \n\nThe code below is used to randomly generate 57 variables for our random model.  The values are the column id's of variables and is listed below.\n\nsample(1:8018,57,replace=F)\n\n8018,3870,6845,341,5595,1149,4346,4628,6191,5801,6301,258,\n7377,3483,692,6462,335,1217,2216,5857,7707,6501,4610,2605,51,\n3755,7888,2322,716,4009,2581,2623,2660,6622,3263,7045,6532,1207,4558, 6232,6943,7340,6546,669,4254,579,6689,6502,4095,5355,6675,842,4693,3991,4890,6887,4782"},{"metadata":{"_uuid":"baf3a6220fa38a74328c58b0425dd266562ccced","trusted":false,"_cell_guid":"5e026845-2437-4b31-925c-4db780151db2"},"cell_type":"code","source":"rdtestdf <-CDF[,c(8018,3870,6845,341,5595,1149,4346,4628,6191,5801,6301,258,\n                  7377,3483,692,6462,335,1217,2216,5857,7707,6501,4610,2605,51,\n                  3755,7888,2322,716,4009,2581,2623,2660,6622,3263,7045,6532,1207,4558, \n                  6232,6943,7340,6546,669,4254,579,6689,6502,4095,5355,6675,842,4693,3991,\n                  4890,6887,4782\n                  )]\n\nxgbGrid <- expand.grid(nrounds = c(1, 10),\n                       max_depth = c(1, 4),\n                       eta = c(.1, .4),\n                       gamma = 0,\n                       colsample_bytree = .7,\n                       min_child_weight = 1,\n                       subsample = c(.8, 1))\n\ncctrl1 <- trainControl(method = \"cv\", number = 3, returnResamp = \"all\",\n                       classProbs = TRUE)\n\nAccuraciesXGBTREERD <- c(0.00)\nfor (i in seq(100)) \n{\n  \n  train<- createDataPartition(rdtestdf$`PAM50 mRNA`, p = .70, list = FALSE)\n  trainDF<-rdtestdf[train,]\n  testDF<-rdtestdf[-train,]\n  trainDF$`PAM50 mRNA`<- as.factor(trainDF$`PAM50 mRNA`)\n  \n  xgb <- train(`PAM50 mRNA` ~., data=trainDF, \n               method = \"xgbTree\", \n               trControl = cctrl1,\n               preProc = c(\"center\", \"scale\"),\n               tuneGrid = xgbGrid)\n  \n  bpred <- predict(xgb, newdata=testDF)\n  AccuraciesXGBTREERD[i] <- confusionMatrix(testDF$`PAM50 mRNA`,bpred)$overall[\"Accuracy\"]\n}\n\nplot(density(AccuraciesXGBTREERD))\nsummary(AccuraciesXGBTREERD)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"b65ec4a2c271eb79de11488031752caa7412887f","_cell_guid":"dd15260b-c91d-4183-b580-e75dc68e4c2f"},"cell_type":"markdown","source":"## Part 10: Conclusions \n\nBelow are the mean results from the machine learning methods,  the models are ran mutlptile times so that one can compute the average the accuracy. \n\n### Support Vector Machines(SVM): 97%\n### Neural Network:  96%\n### Multinomial Method: 90%\n### K- Nearest-Neighbors (KNN): 89%\n### Gradient Boosting Machine (GBM): 86%\n### Naïve Bayes: 82%\n### eXtreme Gradient Boosting: 77%\n### eXtreme Gradient Boosting with Random Variables: 55%\n\nThe highest mean classification accuracy resulted from the Support Vector Machines(SVM) and Neural Network model. Models that apply selected predictors from variable selection outperformed the eXtreme Gradient Boosting model with Random Variables in terms of classification accuracy. \n\nTumors will often vary in location, size, shape, and grade(severity). These characteristics, along with hormone receptor status and HER2 status affect prognosis and overall survival rate, the percentage of patients who are still alive for certain period after they were diagnosed with or started treatment for a disease, such as cancer. Currently, research has identified 4 major molecular subtypes within breast cancer tumors, these subtypes are based on the genes that cancer cell express: Luminal A, Luminal B, HER2 Enriched, and Basal (triple negative). Identifying and studying these subtypes has potential in planning more effective treatment optand developing new therapies. \n\n"}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}
